{% extends 'partials/base.html' %}
{% block content %}
<style>
    body {
        background: #f6f9fc;
    }
    .checkout-section {
        background: #fff;
        border-radius: 16px;
        box-shadow: 0 4px 24px rgba(51,153,204,0.08);
        padding: 2rem 2.5rem;
        margin-bottom: 2rem;
    }
    .doctor-img {
        width: 100%;
        height: 350px;
        object-fit: cover;
        border-radius: 12px;
        box-shadow: 0 2px 12px rgba(51,153,204,0.10);
    }
    .theme-btn {
        background-color: #3399cc !important;
        border: none;
        transition: background 0.2s;
    }
    .theme-btn:hover {
        background-color: #287ba6 !important;
    }
    .section-title {
        color: #3399cc;
        font-weight: 700;
        letter-spacing: 1px;
    }
    .summary-card {
        background: #f8fbfd;
        border-radius: 12px;
        padding: 1.5rem;
        box-shadow: 0 2px 8px rgba(51,153,204,0.06);
    }
    .label-title {
        font-weight: 500;
        color: #287ba6;
    }
</style>
<section class="container py-5">
    <div class="row d-flex justify-content-center">
        <div class="col-lg-6 mb-4">
            <div class="checkout-section mb-4">
                <h3 class="section-title mb-4">Bio Data</h3>
                <div class="row">
                    <div class="col-lg-12 mb-3">
                        <label class="mb-2 label-title">Full Name</label>
                        <input type="text" value="{{ billing.patient.full_name }}" readonly class="form-control bg-light" />
                    </div>
                    <div class="col-lg-6 mb-3">
                        <label class="mb-2 label-title">Email</label>
                        <input type="text" value="{{ billing.patient.email }}" readonly class="form-control bg-light" />
                    </div>
                    <div class="col-lg-6 mb-3">
                        <label class="mb-2 label-title">Mobile Number</label>
                        <input type="text" value="{{ billing.patient.mobile }}" readonly class="form-control bg-light" />
                    </div>
                    <div class="col-lg-6 mb-3">
                        <label class="mb-2 label-title">Gender</label>
                        <input type="text" value="{{ billing.patient.gender }}" readonly class="form-control bg-light" />
                    </div>
                    <div class="col-lg-6 mb-3">
                        <label class="mb-2 label-title">Date Of Birth</label>
                        <input type="text" value="{{ billing.patient.dob }}" readonly class="form-control bg-light" />
                    </div>
                    <div class="col-lg-12 mb-3">
                        <label class="mb-2 label-title">Address</label>
                        <input type="text" value="{{ billing.patient.address }}" readonly class="form-control bg-light" />
                    </div>
                </div>
            </div>

            <div class="checkout-section">
                <h3 class="section-title mb-4">Doctor Description</h3>
                <div class="row g-0 align-items-center">
                    <div class="col-12 col-lg-5 mb-3 mb-lg-0">
                        <img class="doctor-img" src="{{ billing.appointment.doctor.image.url }}" alt="Doctor Image" />
                    </div>
                    <div class="col-12 col-lg-7 ps-lg-4">
                        <h4 class="fw-bold mt-2 mb-2" style="color:#287ba6;">
                            {{ billing.appointment.doctor.full_name }}
                        </h4>
                        <p class="fs-6 mt-3">{{ billing.appointment.doctor.bio|default:"" }}</p>
                    </div>
                </div>
            </div>
        </div>

        <div class="col-lg-5 offset-lg-1">
            <div class="summary-card">
                <div class="d-flex justify-content-between mb-2">
                    <span class="fw-semibold fs-5">Sub-total</span>
                    <span class="fs-5">₹{{ billing.sub_total }}</span>
                </div>
                <div class="d-flex justify-content-between mb-3">
                    <span class="fw-bold fs-4">Total</span>
                    <span class="fw-bold fs-4" style="color:#3399cc;">₹{{ billing.total }}</span>
                </div>
                <hr>
                <div class="mt-4">
                    <button type="button" id="rzp-button1" class="btn theme-btn text-white w-100 py-2 fs-5">
                        Pay with Razorpay <i class="fas fa-credit-card ms-2"></i>
                    </button>
                    <div class="text-center mt-2 text-muted" style="font-size:0.95rem;">
                        Order ID: <span class="fw-semibold">{{ razorpay_order_id }}</span>
                    </div>
                </div>
            </div>
        </div>
    </div>
</section>

<script src="https://checkout.razorpay.com/v1/checkout.js"></script>
<form id="razorpay-form" action="{% url 'base:razorpay_payment_verify' %}" method="POST">
  {% csrf_token %}
  <input type="hidden" name="razorpay_payment_id" id="razorpay_payment_id">
  <input type="hidden" name="razorpay_order_id" id="razorpay_order_id">
  <input type="hidden" name="razorpay_signature" id="razorpay_signature">
  <input type="hidden" name="billing_id" value="{{ billing.billing_id }}">
</form>

<script>
  var options = {
    "key": "{{ razorpay_key_id }}",
    "amount": "{{ amount }}",
    "currency": "INR",
    "name": "VCARE INC.",
    "order_id": "{{ razorpay_order_id }}",
    "handler": function (response){
        document.getElementById('razorpay_payment_id').value = response.razorpay_payment_id;
        document.getElementById('razorpay_order_id').value = response.razorpay_order_id;
        document.getElementById('razorpay_signature').value = response.razorpay_signature;
        document.getElementById('razorpay-form').submit();
    },
    "prefill": {
        "email": "{{ billing.patient.email }}",
        "contact": "{{ billing.patient.mobile }}"
    },
    "theme": {
        "color": "#3399cc"
    }
  };
  var rzp1 = new Razorpay(options);
  document.getElementById('rzp-button1').onclick = function(e){
    rzp1.open();
    e.preventDefault();
}
</script>
{% endblock content %}
